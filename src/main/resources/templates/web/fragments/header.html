<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security5">
<head>
    <meta charset="utf-8" />
    <title>Header</title>

    <!-- CSS mini-cart riêng -->
    <link rel="stylesheet" th:href="@{/css/cart.css}" />
</head>
<body>
<th:block th:fragment="header">

    <div class="backdrop"></div>
    <a class="backtop fas fa-arrow-up" href="#"></a>

    <!-- Top bar -->
    <div class="header-top">
        <div class="container">
            <div class="row">
                <div class="col-md-12 col-lg-5">
                    <div class="header-top-welcome">
                        <p>Chào mừng bạn đến với cửa hàng vinabook !</p>
                    </div>
                </div>
                <div class="col-md-5 col-lg-3">
                    <div class="header-top-select">
                        <div class="header-select">
                            <i class="icofont-world"></i>
                            <select class="select">
                                <option value="vietnam" selected>Việt Nam</option>
                            </select>
                        </div>
                        <div class="header-select">
                            <i class="icofont-money"></i>
                            <select class="select">
                                <option value="vnd" selected>vnđ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header-part">
        <div class="container">
            <div class="header-content">

                <div class="header-media-group">
                    <button class="header-user">
                        <img src="/images/user.png" alt="user"/>
                    </button>
                    <a th:href="@{/}">
                        <img src="/images/logo.png" alt="logo"/>
                    </a>
                    <button class="header-src"><i class="fas fa-search"></i></button>
                </div>

                <a th:href="@{/}" class="header-logo">
                    <img src="/images/logo.png" alt="logo"/>
                </a>

                <a href="javascript:void(0);" class="header-widget" title="Tên của bạn">
                    <img src="/images/user.png" alt="user"/>
                    <span>Hi! <strong><em>[[${displayName}]]</em></strong></span>
                </a>

                <!-- Search -->
                <form th:action="@{/searchProduct}" class="header-form">
                    <input type="text" name="keyword" th:value="${keyword}" placeholder="Tìm kiếm..." autocomplete="off"/>
                    <button><i class="fas fa-search"></i></button>
                </form>

                <!-- Right widgets -->
                <div class="header-widget-group">
                    <a th:href="@{/profile}" class="header-widget" title="Trang cá nhân" sec:authorize="isAuthenticated()">
                        <i class="fas fa-user"></i>
                    </a>

                    <a th:href="@{/favorite}" class="header-widget" title="Yêu thích">
                        <i class="fas fa-heart"></i>
                        <sup th:text="${(totalSave != null) ? totalSave : 0}" id="totalSave">0</sup>
                    </a>

                    <a sec:authorize="hasAnyRole('ADMIN','STAFF')" th:href="@{/admin/home}" class="header-widget" title="Trang quản lý">
                        <i class="fas fa-tools"></i>
                    </a>

                    <!-- Nút mở mini-cart -->
                    <button class="header-widget header-cart js-open-cart" title="Giỏ hàng">
                        <i class="fas fa-shopping-basket"></i>
                        <sup th:text="${(totalCartItems != null) ? totalCartItems : 0}" id="totalCartItems">0</sup>
                    </button>
                </div>

            </div>
        </div>
    </header>

    <!-- Navbar (giữ nguyên của bạn) -->
    <nav class="navbar-part">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="navbar-content">
                        <ul class="navbar-list">
                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Trang chủ</a>
                                <ul class="dropdown-position-list">
                                    <li><a th:href="@{/}">Trang chủ</a></li>
                                </ul>
                            </li>

                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Giới thiệu</a>
                                <ul class="dropdown-position-list">
                                    <li><a th:href="@{/aboutUs}">Giới thiệu</a></li>
                                </ul>
                            </li>

                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Sản phẩm</a>
                                <ul class="dropdown-position-list">
                                    <li><a th:href="@{/products}">Tất cả sản phẩm</a></li>
                                </ul>
                            </li>

                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Thể loại</a>
                                <ul class="dropdown-position-list">
                                    <li th:each="item : ${categoryList}">
                                        <a th:href="@{/productByCategory(id=${item.categoryId})}"
                                           th:text="${item.categoryName}">Thể loại</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Nhà xuất bản</a>
                                <ul class="dropdown-position-list">
                                    <li th:each="pub : ${nxbList}">
                                        <a th:href="@{/productByPublisher(id=${pub.id})}"
                                           th:text="${pub.name}">NXB</a>
                                    </li>
                                </ul>
                            </li>

                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Liên hệ</a>
                                <ul class="dropdown-position-list">
                                    <li><a th:href="@{/contact}">Liên hệ</a></li>
                                </ul>
                            </li>

                            <li class="navbar-item dropdown">
                                <a class="navbar-link dropdown-arrow" href="javascript:void(0);">Tài khoản</a>
                                <ul class="dropdown-position-list">
                                    <th:block sec:authorize="isAnonymous()">
                                        <li><a th:href="@{/login}">Đăng nhập</a></li>
                                        <li><a th:href="@{/register}">Đăng ký</a></li>
                                        <li><a th:href="@{/forgotPassword}">Quên mật khẩu</a></li>
                                    </th:block>
                                    <th:block sec:authorize="isAuthenticated()">
                                        <li><a th:href="@{/profile}">Thông tin tài khoản</a></li>
                                        <li><a th:href="@{/profile/change-password}">Đổi Mật khẩu</a></li>
                                        <li><a th:href="@{/logout}">Đăng xuất</a></li>
                                    </th:block>
                                </ul>
                            </li>
                        </ul>

                        <div class="navbar-info-group">
                            <div class="navbar-info">
                                <i class="icofont-ui-touch-phone"></i>
                                <p><small>Số điện thoại</small><span>(+84) 338 515 037</span></p>
                            </div>
                            <div class="navbar-info">
                                <i class="icofont-ui-email"></i>
                                <p><small>email</small><span>ttthinh2904@gmail.com</span></p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Cart sidebar -->
    <aside class="cart-sidebar" id="miniCart">
        <div class="cart-header">
            <div class="cart-total">
                <i class="fas fa-shopping-basket"></i>
                <span> Tổng số lượng giỏ hàng (<span id="miniCartCount" th:text="${(totalCartItems != null) ? totalCartItems : 0}">0</span>) </span>
            </div>
            <button class="cart-close js-close-cart"><i class="icofont-close"></i></button>
        </div>

        <!-- Empty cart -->
        <div id="miniCartEmpty" th:if="${(totalCartItems == null) or (totalCartItems == 0)}" class="text-center p-4">
            <h4 style="color:#119744" class="mt-5">Hiện tại bạn chưa có sản phẩm nào trong giỏ hàng!</h4>
            <h5 style="color:#119744">Hãy mua sắm đi nào!</h5>
            <a th:href="@{/products}" style="text-decoration:underline;">Click tại đây!</a>
        </div>

        <!-- Has items -->
        <th:block th:if="${(totalCartItems != null) and (totalCartItems > 0)}">
            <ul class="cart-list" id="miniCartList">
                <li class="cart-item"
                    th:each="item : ${(cartItems != null) ? cartItems : T(java.util.Collections).emptyList()}"
                    th:attr="data-id=${item.product.productId}">
                    <div class="cart-media">
                        <a th:href="@{/productDetail(id=${item.product.productId})}">
                            <img th:src="@{'/loadImage?imageName=' + ${item.product.productImage}}" alt="product"/>
                        </a>
                    </div>
                    <div class="cart-info-group">
                        <div class="cart-info">
                            <h6 class="mb-1">
                                <a th:href="@{/productDetail(id=${item.product.productId})}" class="prod-name" th:text="${item.product.productName}">Tên sp</a>
                            </h6>
                            <div class="price-row">Đơn giá: <strong class="unit-price"
                                                                    th:text="${#numbers.formatDecimal(item.product.price - (item.product.price * item.product.discount/100), 1, 'DEFAULT', 0, 'DEFAULT')} + ' đ'">0 đ</strong></div>
                        </div>

                        <div class="action-row">
                            <div class="qty-row">
                                <button class="qty-btn js-dec" th:attr="data-id=${item.product.productId}">−</button>
                                <input class="qty-input js-qty" type="tel" th:attr="data-id=${item.product.productId}" th:value="${item.quantity}" />
                                <button class="qty-btn js-inc" th:attr="data-id=${item.product.productId}">+</button>
                            </div>
                            <div class="stock-row">Còn: <span class="stock js-stock"
                                                              th:text="${item.product.quantity - item.quantity}">0</span> đ</div>
                            <button class="rm-btn js-remove" title="Xoá" th:attr="data-id=${item.product.productId}">
                                <i class="icofont-trash"></i>
                            </button>
                        </div>

                        <div class="line-row">
                            <span>Tạm tính:</span>
                            <strong class="line-total js-line"
                                    th:text="${#numbers.formatDecimal((item.product.price - (item.product.price * item.product.discount/100)) * item.quantity, 1, 'DEFAULT', 0, 'DEFAULT')} + ' đ'">0 đ</strong>
                        </div>
                    </div>
                </li>
            </ul>

            <div class="cart-footer">
                <div class="sum-row">Tổng cộng: <strong id="miniCartTotal"
                                                        th:text="${#numbers.formatDecimal(totalPrice, 1, 'DEFAULT', 0, 'DEFAULT')} + ' đ'">0 đ</strong></div>
                <a class="cart-checkout-btn" th:href="@{/checkout}">
                    <span class="checkout-label">Thanh Toán</span>
                </a>
            </div>
        </th:block>
    </aside>

    <!-- JS mini-cart -->
    <script defer th:src="@{/js/cart.js}"></script>
</th:block>
</body>
</html>
