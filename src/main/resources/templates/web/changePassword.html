<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="author" content="mironcoder"/>
    <meta name="email" content="mironcoder@gmail.com"/>
    <meta name="profile" content="https://themeforest.net/user/mironcoder"/>
    <meta name="template" content="book"/>
    <meta name="title" content="book - Ecommerce Book Store HTML Template"/>
    <meta name="keywords" content="organic, food, shop, ecommerce, store, html, bootstrap, template, agriculture, vegetables, products, farm, grocery, natural, online"/>
    <title>Web bán sách giá rẻ</title>

    <link rel="icon" href="images/favicon.png"/>
    <link rel="stylesheet" href="fonts/flaticon/flaticon.css"/>
    <link rel="stylesheet" href="fonts/icofont/icofont.min.css"/>
    <link rel="stylesheet" href="fonts/fontawesome/fontawesome.min.css"/>
    <link rel="stylesheet" href="vendor/venobox/venobox.min.css"/>
    <link rel="stylesheet" href="vendor/slickslider/slick.min.css"/>
    <link rel="stylesheet" href="vendor/niceselect/nice-select.min.css"/>
    <link rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/main.css"/>
    <link rel="stylesheet" href="css/user-auth.css"/>

    <style>
        .user-form-card { border-radius: 18px; box-shadow: 0 12px 30px rgba(0,0,0,.08); }
        .user-form-title h2 { font-weight: 800; }
        .pw-wrap { position: relative; }
        .toggle-pass { position:absolute; right:14px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:.6; }
        .toggle-pass:hover { opacity:1; }
        .pw-meter { height: 8px; background:#e9ecef; border-radius: 999px; overflow:hidden; margin-top:6px; }
        .pw-meter > span { display:block; height:100%; width:0%; transition:width .25s ease; }
        .pw-meter.weak  > span { width:33%; background:#ff6b6b; }
        .pw-meter.medium> span { width:66%; background:#f7b731; }
        .pw-meter.strong> span { width:100%; background:#2ecc71; }
        .pw-reqs { list-style:none; padding-left:0; margin:10px 0 0 0; font-size:13px; }
        .pw-reqs li { margin:4px 0; display:flex; align-items:center; gap:6px; color:#6c757d; }
        .pw-reqs li.valid { color:#2ecc71; }
        .pw-reqs i { font-size:14px; }
    </style>
</head>
<body>
<section class="user-form-part">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
                <div class="user-form-logo">
                    <a href="/"><img src="images/logo.png" alt="logo"/></a>
                </div>

                <div class="user-form-card">
                    <div class="user-form-title">
                        <h2>Đặt lại mật khẩu</h2>
                        <br>
                        <div class="alert alert-success" role="alert" th:if="${message}" th:text="${message}"></div>
                        <div class="alert alert-danger" role="alert" th:if="${error}" th:text="${error}"></div>

                        <!-- Sau khi đổi thành công thì show link "Đăng nhập tại đây" -->
                        <div th:if="${showLoginLink}">
                            <a th:href="@{/login}" class="btn btn-link p-0" style="font-weight:600;">Đăng nhập tại đây</a>
                        </div>
                    </div>

                    <form th:action="@{/changePassword}" method="post" th:object="${changePassword}" class="user-form" novalidate>
                        <input type="hidden" name="email" th:value="${email}"/>

                        <!-- New password -->
                        <div class="form-group pw-wrap">
                            <input
                                    type="password"
                                    name="newPassword"
                                    id="newPassword"
                                    th:value="*{newPassword}"
                                    class="form-control"
                                    placeholder="Mật khẩu mới"
                                    minlength="12"
                                    pattern="^(?=.*[A-Za-z])(?=.*\\d)(?=.*[^A-Za-z0-9])\\S{12,128}$"
                                    required
                            />
                            <i class="icofont-eye-alt toggle-pass" data-target="newPassword" title="Hiện/Ẩn mật khẩu"></i>
                            <div class="pw-meter" id="meter"><span></span></div>
                            <ul class="pw-reqs" id="reqs">
                                <li id="r-len"><i class="icofont-close-squared-alt"></i> Tối thiểu 12 ký tự</li>
                                <li id="r-letter"><i class="icofont-close-squared-alt"></i> Có chữ cái (a-z)</li>
                                <li id="r-digit"><i class="icofont-close-squared-alt"></i> Có số (0-9)</li>
                                <li id="r-special"><i class="icofont-close-squared-alt"></i> Có ký tự đặc biệt</li>
                                <li id="r-space"><i class="icofont-close-squared-alt"></i> Không chứa khoảng trắng</li>
                            </ul>
                            <small class="text-danger" th:if="${#fields.hasErrors('newPassword')}">Mật khẩu không hợp lệ</small>
                        </div>

                        <!-- Confirm -->
                        <div class="form-group pw-wrap">
                            <input
                                    type="password"
                                    name="confirmPassword"
                                    id="confirmPassword"
                                    th:value="*{confirmPassword}"
                                    class="form-control"
                                    placeholder="Nhập lại mật khẩu mới"
                                    minlength="12"
                                    required
                            />
                            <i class="icofont-eye-alt toggle-pass" data-target="confirmPassword" title="Hiện/Ẩn mật khẩu"></i>
                            <small class="text-danger" th:if="${#fields.hasErrors('confirmPassword')}">Xác nhận không hợp lệ</small>
                            <small class="text-danger" th:if="${error}">Xác nhận mật khẩu không chính xác!</small>
                        </div>

                        <div class="form-button">
                            <button type="submit" id="submitBtn">Đặt lại mật khẩu</button>
                        </div>
                    </form>
                </div>

                <div class="user-form-remind">
                    <p>Quay Trở Lại <a th:href="@{/login}">Đăng Nhập Tại Đây</a></p>
                </div>
                <div class="user-form-footer">
                    <p>Book-Shop | &COPY; Developer by <a href="javascript:void(0);">CT07</a></p>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="vendor/bootstrap/jquery-1.12.4.min.js"></script>
<script src="vendor/bootstrap/popper.min.js"></script>
<script src="vendor/bootstrap/bootstrap.min.js"></script>
<script src="vendor/countdown/countdown.min.js"></script>
<script src="vendor/niceselect/nice-select.min.js"></script>
<script src="vendor/slickslider/slick.min.js"></script>
<script src="vendor/venobox/venobox.min.js"></script>
<script src="js/nice-select.js"></script>
<script src="js/countdown.js"></script>
<script src="js/accordion.js"></script>
<script src="js/venobox.js"></script>
<script src="js/slick.js"></script>
<script src="js/main.js"></script>

<script>
    // Toggle show/hide password
    document.querySelectorAll('.toggle-pass').forEach(function(el){
        el.addEventListener('click', function() {
            var id = el.getAttribute('data-target');
            var input = document.getElementById(id);
            if (!input) return;
            input.type = input.type === 'password' ? 'text' : 'password';
            el.classList.toggle('icofont-eye-alt');
            el.classList.toggle('icofont-eye-blocked');
        });
    });

    // Strength meter & checklist
    (function(){
        var p = document.getElementById('newPassword');
        var meter = document.getElementById('meter');
        var reqs = {
            len: document.getElementById('r-len'),
            letter: document.getElementById('r-letter'),
            digit: document.getElementById('r-digit'),
            special: document.getElementById('r-special'),
            space: document.getElementById('r-space')
        };
        function mark(el, ok) {
            el.classList.toggle('valid', ok);
            el.querySelector('i').className = ok ? 'icofont-check-circled' : 'icofont-close-squared-alt';
        }
        function score(s){
            let sc = 0;
            if (s.length >= 12) sc++;
            if (/[A-Za-z]/.test(s)) sc++;
            if (/\d/.test(s)) sc++;
            if (/[^A-Za-z0-9]/.test(s)) sc++;
            if (!/\s/.test(s)) sc++;
            return sc; // 0..5
        }
        function update(){
            var v = p.value || '';
            mark(reqs.len, v.length >= 12);
            mark(reqs.letter, /[A-Za-z]/.test(v));
            mark(reqs.digit, /\d/.test(v));
            mark(reqs.special, /[^A-Za-z0-9]/.test(v));
            mark(reqs.space, !/\s/.test(v));

            var sc = score(v);
            meter.classList.remove('weak','medium','strong');
            if (sc <=2) meter.classList.add('weak');
            else if (sc ===3 || sc===4) meter.classList.add('medium');
            else meter.classList.add('strong');
        }
        if (p) p.addEventListener('input', update);
        update();
    })();

    // Ngăn khoảng trắng trong password fields
    ['newPassword','confirmPassword'].forEach(function(id){
        var el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('input', function(){
            this.value = this.value.replace(/\s/g,'');
        });
    });
</script>
</body>
</html>
